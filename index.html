<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Troop Cookie Management</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
 
<script>
console.log('üß™ Aggressive mobile fix loading');

window.addEventListener('load', function() {
    console.log('üß™ Window loaded - aggressive button fixing');
    
    // Fix ALL buttons with onclick attributes
    var allButtons = document.querySelectorAll('button[onclick]');
    console.log('üß™ Found ' + allButtons.length + ' buttons with onclick');
    
    for (var i = 0; i < allButtons.length; i++) {
        var btn = allButtons[i];
        var onclickAttr = btn.getAttribute('onclick');
        console.log('üß™ Fixing button: ' + onclickAttr);
        
        // Remove onclick and create new function
        btn.removeAttribute('onclick');
        
        // Create a closure to preserve the onclick value
        (function(button, clickCode) {
            // Add multiple event types for maximum compatibility
            button.addEventListener('touchstart', function(e) {
                console.log('üß™ Touch start: ' + clickCode);
            });
            
            button.addEventListener('touchend', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('üß™ Touch end: ' + clickCode);
                
                // Execute the original onclick code
                try {
                    eval(clickCode);
                } catch (error) {
                    console.log('üß™ Error executing: ' + error);
                }
            });
            
            button.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('üß™ Click: ' + clickCode);
                
                try {
                    eval(clickCode);
                } catch (error) {
                    console.log('üß™ Error executing: ' + error);
                }
            });
            
            // Also try direct onclick assignment
            button.onclick = function(e) {
                console.log('üß™ Direct onclick: ' + clickCode);
                try {
                    eval(clickCode);
                } catch (error) {
                    console.log('üß™ Error executing: ' + error);
                }
            };
            
        })(btn, onclickAttr);
    }
    
    console.log('üß™ All buttons fixed with multiple event handlers');
});

// Even more aggressive - add touch support to document
document.addEventListener('touchstart', function() {}, { passive: true });
</script>

</script>
    <div class="header">
    <div>
        <h1>Troop 167 Cookie Management</h1>
        <p>Girl Scout Cookie Season 2025</p>
    </div>
    
    <!-- NEW: Mobile Menu Toggle -->
    <button class="menu-toggle" id="mobileMenuToggle">
        <span></span>
        <span></span>
        <span></span>
    </button>
</div>
    <!-- Mobile Navigation Overlay -->
<div class="mobile-nav-overlay" id="mobileNavOverlay"></div>

<!-- Mobile Navigation Menu -->
<nav class="mobile-nav" id="mobileNav">
    <div class="mobile-nav-header">
        Cookie Management
    </div>
    
    <div class="mobile-nav-user" id="mobileUserInfo" style="display: none;">
        <div class="user-name" id="mobileUserName">User Name</div>
        <span class="user-role" id="mobileUserRole">ROLE</span>
    </div>

    <ul class="mobile-nav-items" id="mobileNavItems">
        <!-- Navigation items will be populated by JavaScript -->
    </ul>

    <div class="mobile-nav-footer">
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
</nav>

<div class="container">

    <div class="container">
        <!-- Login Screen -->
        <div id="loginScreen">
            <div class="section" style="max-width: 400px; margin: 50px auto;">
                <h2>Login to Cookie Management</h2>
                
                <!-- Google Sheets Connection -->
                <div id="googleAuthSection" style="text-align: center; margin-bottom: 20px; padding: 15px; background: #e3f2fd; border-radius: 5px;">
                    <p><strong>Connect to Google Sheets</strong></p>
                    <button id="authorize_button" class="btn" style="background: #6c757d;" disabled>
                        Loading APIs...
                    </button>
                    <p style="font-size: 0.9rem; margin-top: 10px; color: #666;">
                        Connect to load/save data from your Google Sheet
                    </p>
                </div>

                <div id="loginMessages"></div>
                
                <div class="form-group">
                    <label>Email or Full Name:</label>
                    <input type="text" id="loginEmail" class="form-control" placeholder="your.email@gmail.com">
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="loginPassword" class="form-control" placeholder="Password">
                </div>
                <div class="form-group">
                    <label>Role:</label>
                    <select id="loginRole" class="form-control">
                        <option value="parent">Parent</option>
                        <option value="cookie-mom">Cookie Mom</option>
                    </select>
                </div>
                
                <button class="btn" onclick="attemptLogin()">Login</button>
                
                <div style="margin-top: 20px; padding: 15px; background: #e9ecef; border-radius: 5px; font-size: 0.9rem;">
                    <strong>Demo Accounts:</strong><br>
                    Cookie Mom: <code>mom@troop167.com</code> / <code>cookies2025</code><br>
                    Parent: <code>parent@example.com</code> / <code>parent123</code>
                </div>

                <!-- Test Section -->
                <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; padding: 15px; margin: 20px 0; text-align: center;">
                    <h3>JavaScript Test</h3>
                    <button onclick="testFunction()" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 10px;">
                        Test JavaScript
                    </button>
                    <p id="testResult">Click the button to test if JavaScript is working</p>
                </div>
            </div>
        </div>

        <!-- Main App (hidden until login) -->
        <div id="mainApp" style="display: none;">
            <!-- User Info Bar -->
            <div id="userInfoBar" style="background: #f8f9fa; padding: 10px 20px; border-radius: 5px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <strong id="currentUserName">Loading...</strong> 
                    <span id="currentUserRole" style="background: #e9ecef; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; margin-left: 10px;"></span>
                </div>
                <button onclick="logout()" style="background: #dc3545; color: white; border: none; padding: 5px 15px; border-radius: 3px; cursor: pointer;">Logout</button>
            </div>

            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('dashboard')" id="dashboardTab">üìä Dashboard</button>
                <button class="nav-tab" onclick="showTab('orders')" id="ordersTab">üì¶ Troop Orders</button>
                <button class="nav-tab" onclick="showTab('girls')" id="girlsTab">üëß Girl Management</button>
                <button class="nav-tab" onclick="showTab('transfers')" id="transfersTab">üîÑ Transfers</button>
                <button class="nav-tab" onclick="showTab('money')" id="moneyTab">üí∞ Money Collection</button>
                <button class="nav-tab" onclick="showTab('booths')" id="boothsTab">üç™ Booth Management</button>
                <button class="nav-tab" onclick="showTab('request-approval')" id="requestApprovalTab" style="display: none;">‚úÖ Parent Requests</button>
                <button class="nav-tab" onclick="showTab('parent-orders')" id="parentOrdersTab" style="display: none;">üìù My Orders</button>
            
                <button class="nav-tab" onclick="showTab('my-sales')" id="mySalesTab" style="display: none;">üìà My Sales</button>
                <button class="nav-tab" onclick="showTab('my-balance')" id="myBalanceTab" style="display: none;">üí≥ My Balance</button>
                <button class="nav-tab" onclick="showTab('parent-booths')" id="parentBoothsTab" style="display: none;">üóìÔ∏è Booth Signups</button>
            
            </div>

            <!-- Dashboard Tab (Cookie Mom only) -->
            <div class="tab-content active" id="dashboard">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Cases Ordered</h3>
                        <div class="value" id="totalCasesDisplay">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Troop Inventory</h3>
                        <div class="value" id="troopInventoryDisplay">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Girls' Inventory</h3>
                        <div class="value" id="girlsInventoryDisplay">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Value</h3>
                        <div class="value" id="totalValueDisplay">$0</div>
                    </div>
                </div>

                <div class="section">
                    <h2>Current Troop Inventory</h2>
                    <div class="inventory-grid" id="inventoryDisplay">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
                
                <div class="section" id="pendingRequestsSection" style="display: none;">
                    <h2>Pending Parent Requests</h2>
                    <div id="pendingRequestsDisplay">
                        <p style="color: #666; text-align: center; padding: 20px;">No pending requests</p>
                    </div>
                </div>
            </div>
            

            <!-- Parent Orders Tab (Parent View) -->
            <div class="tab-content" id="parent-orders">
                <div class="section">
                    <h2>Request Cookies from Troop</h2>
                    <div id="parentOrderMessages"></div>
                    
                    <div style="background: #e9ecef; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                        <strong>How it works:</strong> Request cookies from the troop inventory. The Cookie Mom will review and approve your request (full or partial).
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Request for Girl:</label>
                            <select id="parentOrderGirl" class="form-control">
                                <option value="">Select your girl...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Reason for Request:</label>
                            <select id="parentOrderReason" class="form-control">
                                <option value="weekly-order">Weekly Order</option>
                                <option value="booth-prep">Booth Preparation</option>
                                <option value="running-low">Running Low on Inventory</option>
                                <option value="special-order">Large Special Order</option>
                            </select>
                        </div>
                    </div>
                    
                    <h3 style="margin: 20px 0;">Cookie Request (Boxes)</h3>
                    <div class="cookie-grid" id="parentOrderGrid">
                        <!-- Will be populated by JavaScript -->
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0; font-size: 1.2rem; font-weight: bold;">
                        Total Request: <span id="parentOrderTotalBoxes">0</span> boxes = $<span id="parentOrderTotalValue">0</span>
                    </div>
                    
                    <button class="btn" onclick="submitParentOrder()">Submit Cookie Request</button>
                </div>
                
                <div class="section">
                    <h2>My Cookie Requests</h2>
                    <div id="parentOrderHistoryDisplay">
                        <p style="color: #666; text-align: center; padding: 20px;">No requests submitted yet</p>
                    </div>
                </div>
            </div>

            <!-- My Sales Tab (Parent View) -->
            <div class="tab-content" id="my-sales">
                <div class="section">
                    <h2>Personal Sales Tracker</h2>
                    <div id="mySalesMessages"></div>
                    
                    <div style="background: #fff3cd; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                        <strong>Note:</strong> This is your personal tracking only. It doesn't affect the main troop records or your balance.
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Sale Date:</label>
                            <input type="date" id="saleDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Customer/Location:</label>
                            <input type="text" id="saleCustomer" class="form-control" placeholder="Smith family, Office, etc.">
                        </div>
                        <div class="form-group">
                            <label>Payment Method:</label>
                            <select id="salePaymentMethod" class="form-control">
                                <option value="cash">Cash</option>
                                <option value="digital-cookie">Digital Cookie</option>
                                <option value="check">Check</option>
                                <option value="venmo">Venmo</option>
                            </select>
                        </div>
                    </div>
                    
                    <h3 style="margin: 20px 0;">Boxes Sold</h3>
                    <div class="cookie-grid" id="mySalesGrid">
                        <!-- Will be populated by JavaScript -->
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0; font-size: 1.2rem; font-weight: bold;">
                        Sale Total: <span id="mySaleTotalBoxes">0</span> boxes = $<span id="mySaleTotalValue">0</span>
                    </div>
                    
                    <button class="btn" onclick="recordPersonalSale()">Record Sale</button>
                </div>
                
                <div class="section">
                    <h2>My Sales Summary</h2>
                    <div id="mySalesSummaryDisplay">
                        <p style="color: #666; text-align: center; padding: 20px;">No sales recorded yet</p>
                    </div>
                </div>
            </div>

            <!-- My Balance Tab (Parent View) -->
            <div class="tab-content" id="my-balance">
                <div class="section">
                    <h2>My Account Balance</h2>
                    <div id="myBalanceDisplay">
                        <p style="text-align: center; padding: 20px;">Loading balance information...</p>
                    </div>
                </div>
                
                <div class="section">
                    <h2>My Payment History</h2>
                    <div id="myPaymentHistoryDisplay">
                        <p style="color: #666; text-align: center; padding: 20px;">No payments recorded yet</p>
                    </div>
                </div>
            </div>

            <!-- Parent Booth Signups Tab (Parent View) -->
            <div class="tab-content" id="parent-booths">
                <div class="section">
                    <h2>Booth Signups</h2>
                    <div id="parentBoothsMessages"></div>

                    <div class="section">
                        <h3>Available Booths</h3>
                        <div id="parentBoothList">
                            <p style="color: #666; text-align: center; padding: 20px;">No upcoming booths to display</p>
                        </div>
                    </div>

                    <div class="section">
                        <h3>My Signups</h3>
                        <div id="parentBoothSignups">
                            <p style="color: #666; text-align: center; padding: 20px;">You have no booth signups yet</p>
                        </div>
                    </div>

                    <div class="section">
                        <h3>Booth Credits</h3>
                        <div id="parentBoothCredits">
                            <p style="color: #666; text-align: center; padding: 20px;">No booth credits to display</p>
                        </div>
                    </div>
                </div>
            </div>

            

            <!-- Cookie Mom tabs (hidden for parents) -->
            <div class="tab-content" id="orders">
                <div class="section">
                    <h2>Place New Troop Order</h2>
                    <div id="orderMessages"></div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Order Type:</label>
                            <select id="orderType" class="form-control">
                                <option value="initial">Initial Order</option>
                                <option value="additional">Additional Order</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Order Date:</label>
                            <input type="date" id="orderDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Expected Delivery:</label>
                            <input type="date" id="deliveryDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Pickup Location:</label>
                            <input type="text" id="pickupLocation" class="form-control" placeholder="Girl Scout Office, 123 Main St">
                        </div>
                    </div>

                    <h3 style="margin: 20px 0;">Cookie Order (Cases - 12 boxes each at $6/box = $72/case)</h3>
                    <div class="cookie-grid" id="cookieOrderGrid">
                        <!-- Will be populated by JavaScript -->
                    </div>

                    <div style="text-align: center; margin: 20px 0; font-size: 1.2rem; font-weight: bold;">
                        Total: <span id="orderTotalCases">0</span> cases = 
                        <span id="orderTotalBoxes">0</span> boxes = 
                        $<span id="orderTotalCost">0</span>
                    </div>

                    <button class="btn" onclick="submitTroopOrder()">Submit Troop Order</button>
                </div>

                <div class="section">
                    <h2>Order History</h2>
                    <div id="orderHistoryDisplay">
                        <p style="color: #666; text-align: center; padding: 20px;">No orders placed yet</p>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="girls">
                <div class="section">
                    <h2>Add New Girl</h2>
                    <div id="girlMessages"></div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Girl's Name:</label>
                            <input type="text" id="girlName" class="form-control" placeholder="Emma Johnson">
                        </div>
                        <div class="form-group">
                            <label>Parent/Guardian Name:</label>
                            <input type="text" id="parentName" class="form-control" placeholder="Sarah Johnson">
                        </div>
                        <div class="form-group">
                            <label>Participation Type:</label>
                            <select id="participationType" class="form-control">
                                <option value="cookies-on-hand">Cookies on Hand</option>
                                <option value="on-demand">On Demand</option>
                                <option value="booth-only">Booth Only</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Contact Info:</label>
                            <input type="text" id="contactInfo" class="form-control" placeholder="Phone or email">
                        </div>
                    </div>
                    <button class="btn" onclick="addGirl()">Add Girl</button>
                </div>

                <div class="section">
                    <h2>Girl List</h2>
                    <div id="girlListDisplay">
                        <p style="color: #666; text-align: center; padding: 20px;">No girls added yet</p>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="transfers">
                <div class="section">
                    <h2>Manual Cookie Transfer</h2>
                    <div id="transferMessages"></div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Transfer From:</label>
                            <select id="transferFrom" class="form-control" onchange="updateTransferFromInventory()">
                                <option value="">Select source...</option>
                                <option value="troop">Troop Inventory</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Transfer To:</label>
                            <select id="transferTo" class="form-control" onchange="validateTransferSelection()">
                                <option value="">Select destination...</option>
                                <option value="troop">Troop Inventory</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Transfer Date:</label>
                            <input type="date" id="transferDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Reason/Notes:</label>
                            <select id="transferReason" class="form-control">
                                <option value="redistribution">Inventory Redistribution</option>
                                <option value="return">Cookie Return</option>
                                <option value="exchange">Cookie Exchange</option>
                                <option value="damaged">Damaged/Unsellable</option>
                                <option value="parent-trade">Parent Trade</option>
                                <option value="booth-prep">Booth Preparation</option>
                                <option value="other">Other (see notes)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="transferInventoryInfo" style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 15px 0; display: none;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <strong>Available from Source:</strong>
                                <div id="sourceInventoryDisplay">Select source first</div>
                            </div>
                            <div>
                                <strong>Current at Destination:</strong>
                                <div id="destInventoryDisplay">Select destination first</div>
                            </div>
                        </div>
                    </div>
                    
                    <h3 style="margin: 20px 0;">Transfer Quantity (Boxes)</h3>
                    <div class="cookie-grid" id="transferGrid">
                        <!-- Will be populated by JavaScript -->
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0; font-size: 1.2rem; font-weight: bold;">
                        Total Transfer: <span id="transferTotalBoxes">0</span> boxes = $<span id="transferTotalValue">0</span>
                    </div>
                    
                    <div class="form-group">
                        <label>Additional Notes:</label>
                        <textarea id="transferNotes" class="form-control" rows="3" placeholder="Optional notes about this transfer..."></textarea>
                    </div>
                    
                    <button class="btn" onclick="executeTransfer()">Execute Transfer</button>
                </div>
                
                <div class="section">
                    <h2>Transfer History</h2>
                    <div id="transferHistoryDisplay">
                        <p style="color: #666; text-align: center; padding: 20px;">No transfers recorded yet</p>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="money">
                <div class="section">
                    <h2>Record Payment</h2>
                    <div id="moneyMessages"></div>
        
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Payment From:</label>
                            <select id="paymentGirl" class="form-control" onchange="updatePaymentBalance()">
                                <option value="">Select girl...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Payment Date:</label>
                            <input type="date" id="paymentDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Payment Method:</label>
                            <select id="paymentMethod" class="form-control">
                                <option value="cash">Cash</option>
                                <option value="check">Check</option>
                                <option value="venmo">Venmo</option>
                                <option value="cashapp">Cash App</option>
                                <option value="zelle">Zelle</option>
                                <option value="digital-cookie">Digital Cookie</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Payment Amount:</label>
                            <input type="number" id="paymentAmount" class="form-control" step="0.01" min="0" placeholder="0.00" oninput="validatePaymentAmount()">
                        </div>
                    </div>
        
                    <div id="paymentBalanceInfo" style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 15px 0; display: none;">
                        <strong>Current Balance:</strong> $<span id="currentBalance">0.00</span><br>
                        <strong>After Payment:</strong> $<span id="balanceAfterPayment">0.00</span>
                    </div>
        
                    <div class="form-group">
                        <label>Reference/Notes:</label>
                        <input type="text" id="paymentReference" class="form-control" placeholder="Check #123, Venmo confirmation, etc.">
                    </div>
        
                    <button class="btn" onclick="recordPayment()">Record Payment</button>
                </div>
    
                <div class="section">
                    <h2>Outstanding Balances</h2>
                    <div id="outstandingBalancesDisplay">
                        <p style="color: #666; text-align: center; padding: 20px;">No outstanding balances</p>
                    </div>
                </div>
    
                <div class="section">
                    <h2>Payment History</h2>
                    <div id="paymentHistoryDisplay">
                        <p style="color: #666; text-align: center; padding: 20px;">No payments recorded yet</p>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="booths">
                <div class="section">
                    <h2>Booth Management</h2>
                    <div id="boothMessages"></div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Booth Name/Location:</label>
                            <input type="text" id="boothName" class="form-control" placeholder="Walmart - Main Street">
                        </div>
                        <div class="form-group">
                            <label>Date:</label>
                            <input type="date" id="boothDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Start Time:</label>
                            <input type="time" id="boothStartTime" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>End Time:</label>
                            <input type="time" id="boothEndTime" class="form-control">
                        </div>
                    </div>
                    
                    <button class="btn" onclick="createBooth()">Schedule Booth</button>
                </div>
                
                <div class="section">
                    <h2>Scheduled Booths</h2>
                    <div id="boothListDisplay">
                        <p style="color: #666; text-align: center; padding: 20px;">No booths scheduled</p>
                    </div>
                </div>
            </div>

            <!-- Parent Request Approval Tab (Cookie Mom only) -->
            <div class="tab-content" id="request-approval">
                <div class="section">
                    <h2>Parent Cookie Requests</h2>
                    <div id="requestApprovalMessages"></div>
                    
                    <div id="parentRequestsList">
                        <p style="color: #666; text-align: center; padding: 20px;">No parent requests to review</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Global Loading Overlay -->
    <div id="loadingOverlay" style="position:fixed;inset:0;background:rgba(255,255,255,0.7);display:none;align-items:center;justify-content:center;z-index:9999;">
        <div style="background:#fff;border:1px solid #dee2e6;padding:14px 18px;border-radius:8px;box-shadow:0 2px 12px rgba(0,0,0,.12);font-family:system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;">
            <span id="loadingText">Working‚Ä¶</span>
        </div>
    </div>

    <!-- Google APIs -->
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
    
    <script src="script.js"></script>
</body>
</html>